## 소개

저널에서 캐릭터의 장서 설정을 읽어와 자동으로 마소차지용 토큰을 생성해주는 스크립트입니다.  
토큰의 아이콘이나 게이지를 통해 마소의 충전상태를 확인할 수 있으며, 토큰에서 바로 충전값을 변경할 수도 있습니다.  
TokenMod와 함께 사용할 수 있습니다.

## 사용법
  
### 준비1. 스크립트 적용
1. 세션방의 대문에 해당하는 페이지에서 [설정]->[API 스크립트]를 선택해 스크립트 수정 페이지로 들어갑니다. (PRO 계정에서만 이 메뉴가 보입니다.)
2. 기존에 스크립트가 있는 탭이나 New Script에 [[ magicalogia_mana_token.js ]](https://github.com/kibkibe/roll20-api-scripts/blob/master/magicalogia_mana_token/magicalogia_mana_token.js)의 코드들을 복사해 붙여놓고 [Save Script]로 저장합니다. 
3. 코드 내의 주석이나 매뉴얼 페이지를 참조해서 옵션을 설정합니다.
4. [Save Script]로 저장합니다. 
5. 페이지 아래쪽의 API Output Console에 에러 메시지가 표시되지 않는다면 정상적으로 적용된 것입니다.

### 준비2. Rollable Table에 마소 아이템 생성

#### Option1. 서브 아이콘을 사용하지 않는 경우

##### Option1-1. 각 영역별로 마소의 충전량(or 코스트)마다 이미지를 따로 사용할 경우
![](https://github.com/kibkibe/roll20-api-scripts/blob/master/wiki_image/mt_1.png)

1. 각 영역의 이름별로 Rollable Table을 생성합니다.  
   별,짐승,힘,노래,꿈,어둠,전체의 기본 7종이 필요하며 원하시면 그 외의 속성을 추가하실 수 있습니다.  
   (이름은 '별'이라고 단어 하나만 사용해주세요. '1.별','(마소토큰)별'과 같은 형식이면 인식하지 못합니다.)
2. 생성한 Rollable Table에 마소 차지 개수를 보여주는 아이콘을 등록합니다.  
3. 각 아이콘의 이름을 표시 마소 개수에 맞춰 설정해주세요. 마소 2개가 충전된 상태를 표시하는 아이콘이라면 '2'라고 입력합니다.
       이 때 0부터 낮은 숫자 순으로 위부터 표시되도록 생성합니다.


##### Option1-2. 영역별로 마소속성을 보여주는 이미지 1개씩만 사용할 경우
![](https://github.com/kibkibe/roll20-api-scripts/blob/master/wiki_image/mt_2.png)

1. `collection_name` 옵션에 설정한 것과 같은 이름의 Rollable Table을 생성합니다.  
기본값은 `마소`입니다.
2. 1에서 생성한 Rollable Table에 각 영역의 이름별로 아이템을 생성합니다.
   별,짐승,힘,노래,꿈,어둠,전체의 기본 7종이 필요하며 원하시면 그 외의 속성을 추가하실 수 있습니다.
   (이름은 '별'이라고 단어 하나만 사용해주세요. '1.별','(마소토큰)별'과 같은 형식이면 인식하지 못합니다.)


#### Option2. 서브 아이콘을 사용하는 경우
![](https://github.com/kibkibe/roll20-api-scripts/blob/master/wiki_image/mt_3.png)
서브아이콘을 사용할 경우 장서 토큰은 유지한 채 서브아이콘의 이미지만 변경하여 충전량을 표시합니다.

1. 장서 토큰에 사용할 이미지를 **Option1-2**와 동일한 과정으로 생성합니다.  
   이 이미지들은 장서토큰에 적용되어 해당 마법의 사용 마소 속성을 표시하는데만 사용됩니다.
2. 충전치를 보여주기 위한 이미지를 **Option1-1**과 동일한 과정으로 생성합니다.  
   이 이미지들은 서브아이콘에 적용되어 해당 마법의 충전량을 표시하는데 사용됩니다.  
   서브아이콘을 속성별로 구분하지 않고 한 타입만 사용할 경우 `default_area`에 설정된 것과 동일한 이름의 Rollable Table 하나만 생성합니다.  
   이렇게 설정하면 다양한 속성의 장서를 모두 기본 아이콘으로만 표시하게 됩니다.

### 준비3. 테스트

1. 아래의 형식으로 채팅창에 입력해서 정상적으로 토큰이 생성되는지 확인합니다.
    !장서토큰 --캐릭터명

2. 생성된 토큰을 클릭하고 마소차지-소비 매크로를 사용해 정상적으로 동작하는지 확인합니다.

## 옵션

### 사용 범위 설정
- `page_list`: 토큰을 생성할 페이지의 이름을 지정합니다. 스크립트를 여러곳에서 사용할 경우 콤마(,)로 구분해서 입력합니다. 페이지가 여럿일 경우 Player 북마크가 설정된 페이지에 우선적으로 생성됩니다.

### 기능 사용 설정
- `use_single_icon`: 영역별로 속성을 나타내는 아이콘 하나만 사용하는지(`true`) 마소 개수에 따라 여러개 사용하는지(`false`)를 지정합니다.
- `use_static_icon`: 마소 충전 상태에 따라 아이콘 이미지가 바뀌는 기능을 사용할지(`false`) 마소 충전치와 무관하게 한 이미지로 고정되는지(`true`) 지정합니다. (이 값은 `use_single_icon`이 `false`일 때만 유효합니다.)
- `use_sub_icon`: 장서 토큰은 고정한 채 별도로 충전량을 보여주는 서브 아이콘을 함께 표시할지를 설정합니다. (`true`:사용/`false`:비사용)

### 참조할 값 설정
- `area_list`: 사용할 마소 속성 리스트를 지정합니다. `['별','짐승','힘','노래','꿈','어둠','전체']`와 같은 형식으로 입력합니다.
- `default_area`: 기본 아이콘으로 사용할 마소 영역을 지정합니다. 코스트가 없거나 `area_list`에 포함되지 않은 문자를 입력한 경우 이 속성의 아이콘으로 대체해서 표시합니다.
- `collection_name`: 장서 토큰의 아이콘을 속성당 대표이미지 하나만 사용할 경우, 모든 속성의 아이콘을 모아놓은 Rollable table의 이름을 지정합니다. 기본값은 `마소`입니다.  
   (이 값은 user_single_icon나 use_sub_icon이 true일 때만 유효합니다.)
    **use_sub_icon이 true일 경우**
	장서 토큰의 아이콘은 **collection_name**에 지정된 이름의 테이블에서, 충전게이지 아이콘은 **각 속성명의 테이블**에서 가져옵니다.

### 표시 설정
- `show_name`: 생성된 장서 토큰에 이름을 표시할지를 지정합니다. (true:표시/false:숨김)
- `show_bar`: 생성된 장서 토큰에 충전상태를 나타내는 Bar를 표시할지를 지정합니다. (true:표시/false:숨김)
- `icon_size`: 장서 토큰의 가로,세로 크기를 지정합니다. (가로세로는 콤마(,)로 구분합니다.)
- `grid_size`: 페이지 격자의 가로/세로 크기입니다.
- `default_position`: 장서 토큰을 자동생성할 기본 위치를 지정합니다. 공백으로 둘 경우 화면 중앙을 기준으로 생성합니다. (가로세로는 콤마(,)로 구분합니다.)
- `sub_icon_size`: `use_sub_icon`이 true일 경우, 충전량을 보여주는 서브 아이콘의 가로,세로 크기를 지정합니다. (가로세로는 콤마(,)로 구분합니다.)
- `sub_icon_position`: `use_sub_icon`이 true일 경우, 서브 아이콘을 장서 토큰의 중심 기준으로 어느 위치에 표시할지를 지정합니다. (가로세로 좌표는 콤마(,)로 구분합니다. 중심 기준 왼쪽/상단에 표시할 경우 음수(-)로 표시합니다.)
