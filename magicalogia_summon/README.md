## 소개
마도서대전 RPG 마기카로기아를 Roll20에서 ORPG로 진행할 때

채팅창에 명령어를 입력하는 방식으로 원형 토큰을 손쉽게 생성할 수 있도록 도와주는 스크립트입니다.
	
## 설치법
### 준비21 원형 덱 만들기 & 이름 설정
1. 세션방에서 소환에 사용할 원형들을 Card 덱으로 만듭니다.
2. 카드들의 이름을 `'정령','마검'`등 원형의 이름으로 설정하고 덱의 이름은 `archetype`으로 지정합니다.  
이제 스크립트는 archetype 덱을 원형 타입의 저장소로 인식하고 여기에서 아이콘을 불러옵니다.

### 준비2. 토큰 마커 설정 (옵션)
> 이펙트를 토큰 마커로 표시하지 않을 경우 이 과정은 생략하셔도 됩니다.
1. 세션방 대문 우측의 `Token Marker Sets` 영역에서 원형에 사용할 토큰 마커 세트를 등록합니다. [[ 링크참조 ]](https://help.roll20.net/hc/en-us/articles/360041536313-Token-Marker-Sets)

### 준비3. 스크립트 적용하기
1. roll20 세션방에서 원형을 사용할 페이지에서 GM레이어를 선택합니다.
2. 세션방의 대문에 해당하는 페이지에서 [설정]->[API 스크립트]를 선택해 스크립트 수정 페이지로 들어갑니다. (PRO 계정에서만 이 메뉴가 보입니다.)
3. 기존에 스크립트가 있는 탭이나 New Script에 [[ magicalogia_summon.js ]](https://github.com/kibkibe/roll20-api-scripts/blob/master/magicalogia_summon/magicalogia_summon.js)의 코드들을 복사해 붙여넣습니다.
4. 코드 내의 주석과 [옵션](#옵션) 단락을 참조하여 원하시는대로 옵션을 설정하세요.
5. 룰북의 데이터를 참조하여 각 원형이 보유한 기본 이펙트를 `archetype_list`에 기입합니다. 콤마로 구분합니다.
6. **준비2** 단계에서 토큰 마커를 설정했다면 사용할 마커들의 이름과 API 스크립트의 `effect_list` 옵션의 `marker` 부분을 동일하게 맞춰주세요.  
이 때 이펙트 뒤의 숫자는 포함하지 않습니다.
> 예: `Token Marker Sets`에서의 이름: **boost2** / `marker`의 값: **boost**
7. [Save Script]로 저장합니다. 페이지 아래쪽의 API Output Console에 에러 메시지가 표시되지 않는다면 정상적으로 적용된 것입니다.


## 사용법
### 소환
원형 소환은 `!소환 --(특기명) --(원형타입) --(성장치)` 명령어를 사용합니다. 아래는 예시입니다.

		!소환 --정적 --마검 --부2,캐

> 성장치에는 공적점과 마화를 사용하여 성장시킨 수치만 기입해주세요. 원형이 보유한 기본 이펙트와 자동으로 합산되어 토큰에 표시됩니다.
> 성장치 입력은 `effect_list`의 `keyword`에 포함된 문자열이라면 `부스트`,`boost`,`부` 등 어떤 방식으로 표기해도 무방합니다. 

### 저항
원형의 주문저항은 해당 원항의 토큰을 선택한 후 `!저항 (특기명)` 명령어로 사용할 수 있습니다. 아래는 예시입니다.

		!저항 흐름

### 저항목표
바로 저항을 실행하지 않고 목표치만 확인하려면 `!저항목표 (특기명)` 명령어를 사용합니다. 아래는 예시입니다.

		!저항목표 황금
	
## 옵션
### 기능 설정
이펙트의 표시방식, 환경설정, 사용에 필요한 데이터 등을 기입합니다.
- `use_custom_sheet`:  TATECK님의 커스텀 시트를 사용하는지(`true`) 공개버전 시트를 사용하는지(`false`) 설정합니다. 이 옵션은 저항판정에 사용됩니다.
- `display_type`: 원형의 타입명을 표시할지 (`true`) 생략할지 (`false`) 설정합니다.
- `display_skill`: 원형의 특기를 표시할지 (`true`) 생략할지 (`false`) 설정합니다.
- `use_effect_marker`: 원형의 이펙트를 토큰 마커로 표시할지 (`true`) 표시하지 않을지 (`false`) 설정합니다.
- `use_text`  
`use_effect_marker`가 **true**일 때: 이펙트의 숫자를 마커 위에 텍스트로 표시할지(`true`) 숫자가 포함된 이미지를 불러올지(`false`) 설정합니다.  
`use_effect_marker`가 **false**일 때: 원형토큰의 이름에 이펙트를 기재할지(`true`) 생략할지(`false`) 설정합니다.
- `div_text`: 원형토큰의 이름에 이펙트를 기재하는 옵션일 경우, 이펙트 사이를 분리할 문자열을 설정합니다.
- `archetype_list`: 사용할 원형 및 그 원형이 기본적으로 보유한 이펙트의 목록을 기입합니다.  
원형의 보유 이펙트는 룰북 내의 데이터이기 때문에 무료 배포하는 코드에 포함할 수 없으므로 해당 내용은 수기입하시기 바랍니다.
- `effect_list`: 사용할 이펙트 목록을 설정합니다.
  - `marker`: 사용할 마커의 이름입니다. 마커 이미지에 숫자가 포함된 경우 숫자를 제외한 이름만 입력해주세요.
  - `display_name`: 원형토큰의 이름에 이펙트를 기재하는 옵션일 경우, 해당 이펙트를 기재하는데 사용할 단어를 설정합니다.
  - `keyword`: 해당 이펙트를 인식할 약칭들을 설정합니다. 콤마(,)로 구분합니다.
  - `use_bar`: 이 값이 true로 설정된 이펙트는 마커나 이름표 대신 토큰의 Bar로 표시됩니다.
  - `non_numbering`: 이 값이 true로 설정된 이펙트는 뒤에 숫자가 붙지 않습니다.

> `marker`에는 커스텀한 토큰 마커뿐만 아니라 Roll20에 내장된 기본 마커들도 이용할 수 있습니다.  
> 기본 마커의 이름은 토큰을 클릭했을 때 나오는 마커 설정 팝업에서 마우스를 올리면 확인 가능합니다.

### 토큰 설정
스크립트 내의 주석을 참고해 토큰의 기본 표시위치나 크기, 이름 표시여부를 변경하실 수 있습니다.
- `left`: 원형이 소환되면 기본적으로 배치될 가로 위치
- `top`: 원형이 소환되면 기본적으로 배치될 세로 위치
- `width`: 소환할 원형 토큰의 가로크기
- `height`: 소환할 원형 토큰의 세로크기
- `showname`: 이름표 사용 여부 (`true`/`false`)
- `showplayers_name`: 플레이어에게 이름표를 보일지 여부 (`true`/`false`)
- `bar_location`: Bar가 표시될 기본 위치를 지정합니다. (선택: 'top','overlap_top’,‘overlap_bottom’,'below')

### 매크로 사용
채팅창에 명령어를 모두 입력하는 것이 불편하다면 매크로를 이용하시는 것도 좋습니다.  
아래의 코드로 매크로를 생성한 뒤 실행하면 생성할 원형의 특기명과 타입을 입력하는 팝업이 표시됩니다.

	  !소환 --?{특기명} --?{원형타입} --?{성장치(예:부2,캐,+2,-1)}

매크로를 사용할 것인지 채팅창에 바로 입력할 것인지는 GM과 플레이어가 편의에 따라 선택하세요.
